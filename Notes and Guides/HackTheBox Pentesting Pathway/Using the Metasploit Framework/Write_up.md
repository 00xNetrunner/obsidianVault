---
tags: HTB
---
![[Pasted image 20240626185533.png]]

- Tools like metasploiit are causing a debate within the cyber-security community
- Some people think the tools make the job to easy, and that the pen tester is not able to prove himself
- newer members of the community disagree as it makes learning pen-testing much easier and is a nice intro into how vulnerabilities work. 

# ToC
```table-of-contents
```

#### Cheat sheet
![[Using_The_Metasploit_Framework_Module_Cheat_Sheet.pdf]]

# Introduction to Metasploit
- The metasploiit project is Ruby-Based
- Metasploit offers the pentester a penetration testing platform that enables you to write,test and execute the exploit code. this code can be made by the user or taken from a database of exploits

![[Pasted image 20240627011251.png]]

The pro versions is alot different from the Metasploit Framework, the Pro version of metasploit comes with these additional features:-

- Task Chains
- Social Engineering
- Vulnerability Validations
- GUI
- Quick Start Wizards
- Nexpose Integration 

## Metasploit Framework Console

- Provides an "all-in-one" centralised console
- it is the only supported way to access most of the features within metasploit 
- provides a console based interface to the Framework
- Contains the most features and is the most stable MSF interface
- Full read-line  support, tabbing and command completion, 
- execution of external commands in msfconsole

to start msfconsole, all you need to do is open a terminal and enter the following:
```bash
msfconsole
```

![[Pasted image 20240627012127.png]]

## Modules
The Modules detailed above are split into separate categories in this folder. We will go into detail about these in the next sections. They are contained in the following folders:

```bash
ls /usr/share/metasploit-framework/modules

auxiliary  encoders  evasion  exploits  nops  payloads  post
```

## Plugins
- Offer the pentester more options when using msfconsole, 
- can be manually, automatically loaded as needed to provide extra functionality
```bash
ls /usr/share/metasploit-framework/plugins/

aggregator.rb      ips_filter.rb  openvas.rb           sounds.rb
alias.rb           komand.rb      pcap_log.rb          sqlmap.rb
auto_add_route.rb  lab.rb         request.rb           thread.rb
beholder.rb        libnotify.rb   rssfeed.rb           token_adduser.rb
db_credcollect.rb  msfd.rb        sample.rb            token_hunter.rb
db_tracker.rb      msgrpc.rb      session_notifier.rb  wiki.rb
event_tester.rb    nessus.rb      session_tagger.rb    wmap.rb
ffautoregen.rb     nexpose.rb     socket_logger.rb
```

## Scripts
```bash
ls /usr/share/metasploit-framework/scripts/

meterpreter  ps  resource  shell
```

## Tools 
```bash
ls /usr/share/metasploit-framework/tools/

context  docs     hardware  modules   payloads
dev      exploit  memdump   password  recon
```

### HTB Questions:
![[Pasted image 20240627012850.png]]

# Introduction to MSFconsole

Lets start with interacting with the metasploit framework, all we need to do is input `msfconsole` into our terminal, and it will load. 

## Launching msfconsole
![[Pasted image 20240627013417.png]]

> Use `msfconsole -q` if you do not want to display the artwork that starts alongside msfconsole

## MSF Engagement Structure
The engagement structure can be divided into five main categories

- Enumeration
- Preparation
- Exploitation
- Priv Escalation
- Post-Exploitation

![[Pasted image 20240627013718.png]]

# Modules
Their are thousands of different modules in the metasploit framework, all of these modules are scripts that have already been created and tested in the wild, when we are in `msfconsole` we can select from this extensive database of exploits. 

## Syntax
```bash
<No.> <type>/<os>/<service>/<name>
```

## Example
```bash
794   exploit/windows/ftp/scriptftp_list
```

## Type

| Type      | Desc                                                                                            |
| --------- | ----------------------------------------------------------------------------------------------- |
| Auxiliary | Scanning, fuzzing, sniffing, and admin capabilities. Offer extra assistance and functionality.  |
| Encoders  | Ensure that payloads are intact to their destination.                                           |
| Exploits  | Defined as modules that exploit a vulnerability that will allow for the payload delivery.       |
| NOP's     | (No Operation code) Keep the payload sizes consistent across exploit attempts.                  |
| Payloads  | Code runs remotely and calls back to the attacker machine to establish a connection (or shell). |
| Plugins   | Additional scripts can be integrated within an assessment with msfconsole and coexist.          |
| Post      | Wide array of modules to gather information, pivot deeper, etc.                                 |

## OS
the OS tag speaks for itself, this category will be split up into Linux and windows (32bit & 62bit) categories

## Service

The `Service` tag refers to the vulnerable service that is running on the target machine. For some modules, such as the `auxiliary` or `post` ones, this tag can refer to a more general activity such as `gather`, referring to the gathering of credentials, for example.

## Name

Finally, the `Name` tag explains the actual action that can be performed using this module created for a specific purpose.

## Searching for modules 
```shell-session
msf6 > search eternalromance

Matching Modules
================

   #  Name                                  Disclosure Date  Rank    Check  Description
   -  ----                                  ---------------  ----    -----  -----------
   0  exploit/windows/smb/ms17_010_psexec   2017-03-14       normal  Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution
   1  auxiliary/admin/smb/ms17_010_command  2017-03-14       normal  No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution



msf6 > search eternalromance type:exploit

Matching Modules
================

   #  Name                                  Disclosure Date  Rank    Check  Description
   -  ----                                  ---------------  ----    -----  -----------
   0  exploit/windows/smb/ms17_010_psexec   2017-03-14       normal  Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution
```

Specific Searching
```shell-session
search type:exploit platform:windows cve:2021 rank:excellent microsoft
```


#### HTB Task: 

> [!question]
> Use the Metasploit-Framework to exploit the target with EternalRomance. Find the flag.txt file on Administrator's desktop and submit the contents as the answer.

To solve this Question, i first started `msfconsole`, when loaded i searched for the specific module we will be using, which is `EternalRomance` also known as **EternalBlue**

![[Pasted image 20240627022121.png]]
> To select this module just type `use 0`

when the module has loaded, type in `show options`

in these options we need to set the `RHOSTS` (Target) and `LHOST` (Attacker PC) : 
![[Pasted image 20240627022205.png]]

with these options set we can just type `run` or `exploit` 

![[Pasted image 20240627023603.png]]

> NOTE: Use `exploit/windows/smb/ms17_010_psexec` instead enternalblue will not work, this is a mistake on my part

Now that we have a meterpreter, lets find this flag.txt file, from the meterpreter shell type in `shell`

this will start a windows command prompt, yon also start powershell with `powershell`



from the shell, we navigate to users > Admin > Desktop and we found the flag.txt, open with `cat`

![[Pasted image 20240627024020.png]]

Awnser: **HTB{MSF-W1nD0w5-3xPL01t4t10n}**

