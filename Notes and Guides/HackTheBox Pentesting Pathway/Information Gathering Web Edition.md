![[Information_Gathering_Web_Edition_Module_Cheat_Sheet.pdf]]

The cheat sheet is a useful command reference for this module.

## WHOIS

|**Command**|**Description**|
|---|---|
|`export TARGET="domain.tld"`|Assign target to an environment variable.|
|`whois $TARGET`|WHOIS lookup for the target.|

---

## DNS Enumeration

|**Command**|**Description**|
|---|---|
|`nslookup $TARGET`|Identify the `A` record for the target domain.|
|`nslookup -query=A $TARGET`|Identify the `A` record for the target domain.|
|`dig $TARGET @<nameserver/IP>`|Identify the `A` record for the target domain.|
|`dig a $TARGET @<nameserver/IP>`|Identify the `A` record for the target domain.|
|`nslookup -query=PTR <IP>`|Identify the `PTR` record for the target IP address.|
|`dig -x <IP> @<nameserver/IP>`|Identify the `PTR` record for the target IP address.|
|`nslookup -query=ANY $TARGET`|Identify `ANY` records for the target domain.|
|`dig any $TARGET @<nameserver/IP>`|Identify `ANY` records for the target domain.|
|`nslookup -query=TXT $TARGET`|Identify the `TXT` records for the target domain.|
|`dig txt $TARGET @<nameserver/IP>`|Identify the `TXT` records for the target domain.|
|`nslookup -query=MX $TARGET`|Identify the `MX` records for the target domain.|
|`dig mx $TARGET @<nameserver/IP>`|Identify the `MX` records for the target domain.|

---

## Passive Subdomain Enumeration

|**Resource/Command**|**Description**|
|---|---|
|`VirusTotal`|[https://www.virustotal.com/gui/home/url](https://www.virustotal.com/gui/home/url)|
|`Censys`|[https://censys.io/](https://censys.io/)|
|`Crt.sh`|[https://crt.sh/](https://crt.sh/)|
|`curl -s https://sonar.omnisint.io/subdomains/{domain} \| jq -r '.[]' \| sort -u`|All subdomains for a given domain.|
|`curl -s https://sonar.omnisint.io/tlds/{domain} \| jq -r '.[]' \| sort -u`|All TLDs found for a given domain.|
|`curl -s https://sonar.omnisint.io/all/{domain} \| jq -r '.[]' \| sort -u`|All results across all TLDs for a given domain.|
|`curl -s https://sonar.omnisint.io/reverse/{ip} \| jq -r '.[]' \| sort -u`|Reverse DNS lookup on IP address.|
|`curl -s https://sonar.omnisint.io/reverse/{ip}/{mask} \| jq -r '.[]' \| sort -u`|Reverse DNS lookup of a CIDR range.|
|`curl -s "https://crt.sh/?q=${TARGET}&output=json" \| jq -r '.[] \| "\(.name_value)\n\(.common_name)"' \| sort -u`|Certificate Transparency.|
|`cat sources.txt \| while read source; do theHarvester -d "${TARGET}" -b $source -f "${source}-${TARGET}";done`|Searching for subdomains and other information on the sources provided in the source.txt list.|

#### Sources.txt

Code: txt

```txt
baidu
bufferoverun
crtsh
hackertarget
otx
projecdiscovery
rapiddns
sublist3r
threatcrowd
trello
urlscan
vhost
virustotal
zoomeye
```

---

## Passive Infrastructure Identification

|**Resource/Command**|**Description**|
|---|---|
|`Netcraft`|[https://www.netcraft.com/](https://www.netcraft.com/)|
|`WayBackMachine`|[http://web.archive.org/](http://web.archive.org/)|
|`WayBackURLs`|[https://github.com/tomnomnom/waybackurls](https://github.com/tomnomnom/waybackurls)|
|`waybackurls -dates https://$TARGET > waybackurls.txt`|Crawling URLs from a domain with the date it was obtained.|

---

## Active Infrastructure Identification

|**Resource/Command**|**Description**|
|---|---|
|`curl -I "http://${TARGET}"`|Display HTTP headers of the target webserver.|
|`whatweb -a https://www.facebook.com -v`|Technology identification.|
|`Wappalyzer`|[https://www.wappalyzer.com/](https://www.wappalyzer.com/)|
|`wafw00f -v https://$TARGET`|WAF Fingerprinting.|
|`Aquatone`|[https://github.com/michenriksen/aquatone](https://github.com/michenriksen/aquatone)|
|`cat subdomain.list \| aquatone -out ./aquatone -screenshot-timeout 1000`|Makes screenshots of all subdomains in the subdomain.list.|

---

## Active Subdomain Enumeration

|**Resource/Command**|**Description**|
|---|---|
|`HackerTarget`|[https://hackertarget.com/zone-transfer/](https://hackertarget.com/zone-transfer/)|
|`SecLists`|[https://github.com/danielmiessler/SecLists](https://github.com/danielmiessler/SecLists)|
|`nslookup -type=any -query=AXFR $TARGET nameserver.target.domain`|Zone Transfer using Nslookup against the target domain and its nameserver.|
|`gobuster dns -q -r "${NS}" -d "${TARGET}" -w "${WORDLIST}" -p ./patterns.txt -o "gobuster_${TARGET}.txt"`|Bruteforcing subdomains.|

---

## Virtual Hosts

|**Resource/Command**|**Description**|
|---|---|
|`curl -s http://192.168.10.10 -H "Host: randomtarget.com"`|Changing the HOST HTTP header to request a specific domain.|
|`cat ./vhosts.list \| while read vhost;do echo "\n********\nFUZZING: ${vhost}\n********";curl -s -I http://<IP address> -H "HOST: ${vhost}.target.domain" \| grep "Content-Length: ";done`|Bruteforcing for possible virtual hosts on the target domain.|
|`ffuf -w ./vhosts -u http://<IP address> -H "HOST: FUZZ.target.domain" -fs 612`|Bruteforcing for possible virtual hosts on the target domain using `ffuf`.|

---

## Crawling

|**Resource/Command**|**Description**|
|---|---|
|`ZAP`|[https://www.zaproxy.org/](https://www.zaproxy.org/)|
|`ffuf -recursion -recursion-depth 1 -u http://192.168.10.10/FUZZ -w /opt/useful/SecLists/Discovery/Web-Content/raft-small-directories-lowercase.txt`|Discovering files and folders that cannot be spotted by browsing the website.|
|`ffuf -w ./folders.txt:FOLDERS,./wordlist.txt:WORDLIST,./extensions.txt:EXTENSIONS -u http://www.target.domain/FOLDERS/WORDLISTEXTENSIONS`|Mutated bruteforcing against the target web server.|


# WHOIS Lookups

Now mostly to do my whois scans i have been using websites, but this process can also be done via the linux terminal. 

first of all you need to install whois on arch that is 
```bash
sudo pacman -S whois
```

we can then use the tool like so:
```bash
whois arnoldspcservices.co.uk
```

![[Pasted image 20240504035125.png]]

Perform a WHOIS lookup against the paypal.com domain. What is the registrar Internet Assigned Numbers Authority (IANA) ID number? 

```bash
whois paypal.com | grep 'IANA'
```
we use grep as a lot of information gets posted, so we can use grep just to show the IANA number which in this case is *292*

What is the admin email contact for the tesla.com domain (also in-scope for the Tesla bug bounty program)?
```bash
whois tesla.com | grep 'admin'
```

![[Pasted image 20240504035532.png]]

# DNS

## NSLOOKUP & DIG

![[Pasted image 20240504040124.png]]

```bash
nslookup facebook.com
```

from the nslookup scan we have an server ip address we can now use this in dig command 

```bash
dig facebook@127.0.0.53
```

#### Querying: A Records for a Subdomain

```bash
netrunner404@htb[/htb]$ export TARGET=www.facebook.com
netrunner404@htb[/htb]$ nslookup -query=A $TARGET

Server:		1.1.1.1
Address:	1.1.1.1#53

Non-authoritative answer:
www.facebook.com	canonical name = star-mini.c10r.facebook.com.
Name:	star-mini.c10r.facebook.com
Address: 31.13.92.36
```

```bash
netrunner404@htb[/htb]$ dig a www.facebook.com @1.1.1.1

; <<>> DiG 9.16.1-Ubuntu <<>> a www.facebook.com @1.1.1.1
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 15596
;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
;; QUESTION SECTION:
;www.facebook.com.              IN      A

;; ANSWER SECTION:
www.facebook.com.       3585    IN      CNAME   star-mini.c10r.facebook.com.
star-mini.c10r.facebook.com. 45 IN      A       31.13.92.36

;; Query time: 16 msec
;; SERVER: 1.1.1.1#53(1.1.1.1)
;; WHEN: Mo Okt 18 16:11:48 CEST 2021
;; MSG SIZE  rcvd: 90
```

#### Querying: PTR Records for an IP Address
```bash
netrunner404@htb[/htb]$ nslookup -query=PTR 31.13.92.36

Server:		1.1.1.1
Address:	1.1.1.1#53

Non-authoritative answer:
36.92.13.31.in-addr.arpa	name = edge-star-mini-shv-01-frt3.facebook.com.

Authoritative answers can be found from:
```

```bash
netrunner404@htb[/htb]$ dig -x 31.13.92.36 @1.1.1.1

; <<>> DiG 9.16.1-Ubuntu <<>> -x 31.13.92.36 @1.1.1.1
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 51730
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
;; QUESTION SECTION:
;36.92.13.31.in-addr.arpa.      IN      PTR

;; ANSWER SECTION:
36.92.13.31.in-addr.arpa. 1028  IN      PTR     edge-star-mini-shv-01-frt3.facebook.com.

;; Query time: 16 msec
;; SERVER: 1.1.1.1#53(1.1.1.1)
;; WHEN: Mo Okt 18 16:14:20 CEST 2021
;; MSG SIZE  rcvd: 106
```

#### Querying: ANY Existing Records
```bash
netrunner404@htb[/htb]$ export TARGET="google.com"
netrunner404@htb[/htb]$ nslookup -query=ANY $TARGET

Server:		10.100.0.1
Address:	10.100.0.1#53

Non-authoritative answer:
Name:	google.com
Address: 172.217.16.142
Name:	google.com
Address: 2a00:1450:4001:808::200e
google.com	text = "docusign=05958488-4752-4ef2-95eb-aa7ba8a3bd0e"
google.com	text = "docusign=1b0a6754-49b1-4db5-8540-d2c12664b289"
google.com	text = "v=spf1 include:_spf.google.com ~all"
google.com	text = "MS=E4A68B9AB2BB9670BCE15412F62916164C0B20BB"
google.com	text = "globalsign-smime-dv=CDYX+XFHUw2wml6/Gb8+59BsH31KzUr6c1l2BPvqKX8="
google.com	text = "apple-domain-verification=30afIBcvSuDV2PLX"
google.com	text = "google-site-verification=wD8N7i1JTNTkezJ49swvWW48f8_9xveREV4oB-0Hf5o"
google.com	text = "facebook-domain-verification=22rm551cu4k0ab0bxsw536tlds4h95"
google.com	text = "google-site-verification=TV9-DBe4R80X4v0M4U_bd_J9cpOJM0nikft0jAgjmsQ"
google.com	nameserver = ns3.google.com.
google.com	nameserver = ns2.google.com.
google.com	nameserver = ns1.google.com.
google.com	nameserver = ns4.google.com.
google.com	mail exchanger = 10 aspmx.l.google.com.
google.com	mail exchanger = 40 alt3.aspmx.l.google.com.
google.com	mail exchanger = 20 alt1.aspmx.l.google.com.
google.com	mail exchanger = 30 alt2.aspmx.l.google.com.
google.com	mail exchanger = 50 alt4.aspmx.l.google.com.
google.com
	origin = ns1.google.com
	mail addr = dns-admin.google.com
	serial = 398195569
	refresh = 900
	retry = 900
	expire = 1800
	minimum = 60
google.com	rdata_257 = 0 issue "pki.goog"

Authoritative answers can be found from:
```

```bash
netrunner404@htb[/htb]$ dig any google.com @8.8.8.8

; <<>> DiG 9.16.1-Ubuntu <<>> any google.com @8.8.8.8
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 49154
;; flags: qr rd ra; QUERY: 1, ANSWER: 22, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 512
;; QUESTION SECTION:
;google.com.                    IN      ANY

;; ANSWER SECTION:
google.com.             249     IN      A       142.250.184.206
google.com.             249     IN      AAAA    2a00:1450:4001:830::200e
google.com.             549     IN      MX      10 aspmx.l.google.com.
google.com.             3549    IN      TXT     "apple-domain-verification=30afIBcvSuDV2PLX"
google.com.             3549    IN      TXT     "facebook-domain-verification=22rm551cu4k0ab0bxsw536tlds4h95"
google.com.             549     IN      MX      20 alt1.aspmx.l.google.com.
google.com.             3549    IN      TXT     "docusign=1b0a6754-49b1-4db5-8540-d2c12664b289"
google.com.             3549    IN      TXT     "v=spf1 include:_spf.google.com ~all"
google.com.             3549    IN      TXT     "globalsign-smime-dv=CDYX+XFHUw2wml6/Gb8+59BsH31KzUr6c1l2BPvqKX8="
google.com.             3549    IN      TXT     "google-site-verification=wD8N7i1JTNTkezJ49swvWW48f8_9xveREV4oB-0Hf5o"
google.com.             9       IN      SOA     ns1.google.com. dns-admin.google.com. 403730046 900 900 1800 60
google.com.             21549   IN      NS      ns1.google.com.
google.com.             21549   IN      NS      ns3.google.com.
google.com.             549     IN      MX      50 alt4.aspmx.l.google.com.
google.com.             3549    IN      TXT     "docusign=05958488-4752-4ef2-95eb-aa7ba8a3bd0e"
google.com.             549     IN      MX      30 alt2.aspmx.l.google.com.
google.com.             21549   IN      NS      ns2.google.com.
google.com.             21549   IN      NS      ns4.google.com.
google.com.             549     IN      MX      40 alt3.aspmx.l.google.com.
google.com.             3549    IN      TXT     "MS=E4A68B9AB2BB9670BCE15412F62916164C0B20BB"
google.com.             3549    IN      TXT     "google-site-verification=TV9-DBe4R80X4v0M4U_bd_J9cpOJM0nikft0jAgjmsQ"
google.com.             21549   IN      CAA     0 issue "pki.goog"

;; Query time: 16 msec
;; SERVER: 8.8.8.8#53(8.8.8.8)
;; WHEN: Mo Okt 18 16:15:22 CEST 2021
;; MSG SIZE  rcvd: 922
```

The more recent [RFC8482](https://tools.ietf.org/html/rfc8482) specified that `ANY` DNS requests be abolished. Therefore, we may not receive a response to our `ANY` request from the DNS server or get a reference to the said RFC8482.

DNS

```shell-session
netrunner404@htb[/htb]$ dig any cloudflare.com @8.8.8.8

; <<>> DiG 9.16.1-Ubuntu <<>> any cloudflare.com @8.8.8.8
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 22509
;; flags: qr rd ra ad; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 512
;; QUESTION SECTION:
;cloudflare.com.                        IN      ANY

;; ANSWER SECTION:
cloudflare.com.         2747    IN      HINFO   "RFC8482" ""
cloudflare.com.         2747    IN      RRSIG   HINFO 13 2 3789 20211019145905 20211017125905 34505 cloudflare.com. 4/Bq8xUN96SrOhuH0bj2W6s2pXRdv5L5NWsgyTAGLAjEwwEF4y4TQuXo yGtvD3B13jr5KhdXo1VtrLLMy4OR8Q==

;; Query time: 16 msec
;; SERVER: 8.8.8.8#53(8.8.8.8)
;; WHEN: Mo Okt 18 16:16:27 CEST 2021
;; MSG SIZE  rcvd: 174
```

#### Querying: TXT Records

DNS

```shell-session
netrunner404@htb[/htb]$ export TARGET="facebook.com"
netrunner404@htb[/htb]$ nslookup -query=TXT $TARGET

Server:		1.1.1.1
Address:	1.1.1.1#53

Non-authoritative answer:
facebook.com	text = "v=spf1 redirect=_spf.facebook.com"
facebook.com	text = "google-site-verification=A2WZWCNQHrGV_TWwKh6KHY90tY0SHZo_RnyMJoDaG0s"
facebook.com	text = "google-site-verification=wdH5DTJTc9AYNwVunSVFeK0hYDGUIEOGb-RReU6pJlY"

Authoritative answers can be found from:
```

DNS

```shell-session
netrunner404@htb[/htb]$ dig txt facebook.com @1.1.1.1

; <<>> DiG 9.16.1-Ubuntu <<>> txt facebook.com @1.1.1.1
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 63771
;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
;; QUESTION SECTION:
;facebook.com.                  IN      TXT

;; ANSWER SECTION:
facebook.com.           86400   IN      TXT     "v=spf1 redirect=_spf.facebook.com"
facebook.com.           7200    IN      TXT     "google-site-verification=A2WZWCNQHrGV_TWwKh6KHY90tY0SHZo_RnyMJoDaG0s"
facebook.com.           7200    IN      TXT     "google-site-verification=wdH5DTJTc9AYNwVunSVFeK0hYDGUIEOGb-RReU6pJlY"

;; Query time: 24 msec
;; SERVER: 1.1.1.1#53(1.1.1.1)
;; WHEN: Mo Okt 18 16:17:46 CEST 2021
;; MSG SIZE  rcvd: 249
```

#### Querying: MX Records

DNS

```shell-session
netrunner404@htb[/htb]$ export TARGET="facebook.com"
netrunner404@htb[/htb]$ nslookup -query=MX $TARGET

Server:		1.1.1.1
Address:	1.1.1.1#53

Non-authoritative answer:
facebook.com	mail exchanger = 10 smtpin.vvv.facebook.com.

Authoritative answers can be found from:
```



DNS

```shell-session
netrunner404@htb[/htb]$ dig mx facebook.com @1.1.1.1

; <<>> DiG 9.16.1-Ubuntu <<>> mx facebook.com @1.1.1.1
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 9392
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
;; QUESTION SECTION:
;facebook.com.                  IN      MX

;; ANSWER SECTION:
facebook.com.           3600    IN      MX      10 smtpin.vvv.facebook.com.

;; Query time: 40 msec
;; SERVER: 1.1.1.1#53(1.1.1.1)
;; WHEN: Mo Okt 18 16:18:22 CEST 2021
;; MSG SIZE  rcvd: 68
```

So far, we have gathered `A`, `NS`, `MX`, and `CNAME` records with the `nslookup` and `dig` commands. Organizations are given IP addresses on the Internet, but they aren't always their owners. They might rely on `ISP`s and hosting providers that lease smaller netblocks to them.

We can combine some of the results gathered via nslookup with the whois database to determine if our target organization uses hosting providers. This combination looks like the following example:

----------------------------------
#### Nslookup

DNS

```shell-session
netrunner404@htb[/htb]$ export TARGET="facebook.com"
netrunner404@htb[/htb]$ nslookup $TARGET

Server:		1.1.1.1
Address:	1.1.1.1#53

Non-authoritative answer:
Name:	facebook.com
Address: 157.240.199.35
Name:	facebook.com
Address: 2a03:2880:f15e:83:face:b00c:0:25de
```

-----------------------------

#### WHOIS

DNS

```bash
netrunner404@htb[/htb]$ whois 157.240.199.35

NetRange:       157.240.0.0 - 157.240.255.255
CIDR:           157.240.0.0/16
NetName:        THEFA-3
NetHandle:      NET-157-240-0-0-1
Parent:         NET157 (NET-157-0-0-0-0)
NetType:        Direct Assignment
OriginAS:
Organization:   Facebook, Inc. (THEFA-3)
RegDate:        2015-05-14
Updated:        2015-05-14
Ref:            https://rdap.arin.net/registry/ip/157.240.0.0



OrgName:        Facebook, Inc.
OrgId:          THEFA-3
Address:        1601 Willow Rd.
City:           Menlo Park
StateProv:      CA
PostalCode:     94025
Country:        US
RegDate:        2004-08-11
Updated:        2012-04-17
Ref:            https://rdap.arin.net/registry/entity/THEFA-3


OrgAbuseHandle: OPERA82-ARIN
OrgAbuseName:   Operations
OrgAbusePhone:  +1-650-543-4800
OrgAbuseEmail:  domain@facebook.com
OrgAbuseRef:    https://rdap.arin.net/registry/entity/OPERA82-ARIN

OrgTechHandle: OPERA82-ARIN
OrgTechName:   Operations
OrgTechPhone:  +1-650-543-4800
OrgTechEmail:  domain@facebook.com
OrgTechRef:    https://rdap.arin.net/registry/entity/OPERA82-ARIN
```

Which IP address maps to inlanefreight.com?
![[Pasted image 20240504041101.png]]

Which domain is returned when querying the PTR record for 134.209.24.248?
![[Pasted image 20240504041126.png]]

What is the first mailserver returned when querying the MX records for paypal.com?
![[Pasted image 20240504041301.png]]

-----------------------------------

# Passive Subdomain Enumeration
Go Back And Complete

# Passive Infrastructure Identification 
Go Over Websites like netcraft etc..


# Active Infrastructure Identification

## HTTP Headers
![[Pasted image 20240505015535.png]]

![[Pasted image 20240505015557.png]]

------------------------------------
## WhatWeb
**WhatWeb** Is a tool used to see the web technologies used on a site. for example. if we use whatweb on Facebook it will tell us what technology Facebook is built with 

```shell-session
netrunner404@htb[/htb]$ whatweb -a3 https://www.facebook.com -v

WhatWeb report for https://www.facebook.com
Status    : 200 OK
Title     : <None>
IP        : 31.13.92.36
Country   : IRELAND, IE

Summary   : Strict-Transport-Security[max-age=15552000; preload], PasswordField[pass], Script[text/javascript], X-XSS-Protection[0], HTML5, X-Frame-Options[DENY], Meta-Refresh-Redirect[/?_fb_noscript=1], UncommonHeaders[x-fb-rlafr,x-content-type-options,x-fb-debug,alt-svc]

Detected Plugins:
[ HTML5 ]
	HTML version 5, detected by the doctype declaration

```

We can also use browser extensions like **[Wappalyzer](https://addons.mozilla.org/en-GB/firefox/addon/wappalyzer/)** to see what makes a website '
![[Pasted image 20240505135256.png]]

## WafWOOf
**WafW00f** is a web application firewall fingerprinting tool, it will send requests and analyse the response to determine if a security solution is in place. 

to install the tool:-

**Debian**
```bash
sudo apt install wafw00f -y
```

**Arch**
```
sudo pacman -S wafw00f -y
```

```bash
wafw00f -v https://www.tesla.com

                   ______
                  /      \
                 (  Woof! )
                  \  ____/                      )
                  ,,                           ) (_
             .-. -    _______                 ( |__|
            ()``; |==|_______)                .)|__|
            / ('        /|\                  (  |__|
        (  /  )        / | \                  . |__|
         \(_)_))      /  |  \                   |__|

                    ~ WAFW00F : v2.1.0 ~
    The Web Application Firewall Fingerprinting Toolkit

[*] Checking https://www.tesla.com
[+] The site https://www.tesla.com is behind CacheWall (Varnish) WAF.
[~] Number of requests: 2
```

------------------------------
## Aquatone

```bash
aquatone --help

Usage of aquatone:
  -chrome-path string
    	Full path to the Chrome/Chromium executable to use. By default, aquatone will search for Chrome or Chromium
  -debug
    	Print debugging information
  -http-timeout int
    	Timeout in miliseconds for HTTP requests (default 3000)
  -nmap
    	Parse input as Nmap/Masscan XML
  -out string
    	Directory to write files to (default ".")
  -ports string
    	Ports to scan on hosts. Supported list aliases: small, medium, large, xlarge (default "80,443,8000,8080,8443")
  -proxy string
    	Proxy to use for HTTP requests
  -resolution string
    	screenshot resolution (default "1440,900")
  -save-body
    	Save response bodies to files (default true)
  -scan-timeout int
    	Timeout in miliseconds for port scans (default 100)
  -screenshot-timeout int
    	Timeout in miliseconds for screenshots (default 30000)
  -session string
    	Load Aquatone session file and generate HTML report
  -silent
    	Suppress all output except for errors
  -template-path string
    	Path to HTML template to use for report
  -threads int
    	Number of concurrent threads (default number of logical CPUs)
  -version
    	Print current Aquatone version
```


```bash
cat facebook_aquatone.txt | aquatone -out ./aquatone -screenshot-timeout 1000

aquatone v1.7.0 started at 2021-10-06T10:14:42+01:00

Targets    : 30
Threads    : 2
Ports      : 80, 443, 8000, 8080, 8443
Output dir : aquatone

edge-star-shv-01-cdg2.facebook.com: port 80 open
edge-extern-shv-01-waw1.facebook.com: port 80 open
whatsapp-chatd-edge-shv-01-ams4.facebook.com: port 80 open
edge-secure-shv-01-ham3.facebook.com: port 80 open
sv-se.facebook.com: port 80 open
ko.facebook.com: port 80 open
whatsapp-chatd-msgr-mini-edge-shv-01-lis1.facebook.com: port 80 open
synthetic-e2e-elbprod-sli-shv-01-otp1.facebook.com: port 80 open
edge-star-shv-01-cdg2.facebook.com: port 443 open
edge-extern-shv-01-waw1.facebook.com: port 443 open
whatsapp-chatd-edge-shv-01-ams4.facebook.com: port 443 open
http://edge-star-shv-01-cdg2.facebook.com/: 200 OK
http://edge-extern-shv-01-waw1.facebook.com/: 200 OK
edge-secure-shv-01-ham3.facebook.com: port 443 open
ondemand-edge-shv-01-cph2.facebook.com: port 443 open
sv-se.facebook.com: port 443 open
http://edge-secure-shv-01-ham3.facebook.com/: 200 OK
ko.facebook.com: port 443 open
whatsapp-chatd-msgr-mini-edge-shv-01-lis1.facebook.com: port 443 open
http://sv-se.facebook.com/: 200 OK
http://ko.facebook.com/: 200 OK
synthetic-e2e-elbprod-sli-shv-01-otp1.facebook.com: port 443 open
http://synthetic-e2e-elbprod-sli-shv-01-otp1.facebook.com/: 400 default_vip_400
https://edge-star-shv-01-cdg2.facebook.com/: 200 OK
https://edge-extern-shv-01-waw1.facebook.com/: 200 OK
http://edge-star-shv-01-cdg2.facebook.com/: screenshot timed out
http://edge-extern-shv-01-waw1.facebook.com/: screenshot timed out
https://edge-secure-shv-01-ham3.facebook.com/: 200 OK
https://sv-se.facebook.com/: 200 OK
https://ko.facebook.com/: 200 OK
http://edge-secure-shv-01-ham3.facebook.com/: screenshot timed out
http://sv-se.facebook.com/: screenshot timed out
http://ko.facebook.com/: screenshot timed out
https://synthetic-e2e-elbprod-sli-shv-01-otp1.facebook.com/: 400 default_vip_400
http://synthetic-e2e-elbprod-sli-shv-01-otp1.facebook.com/: screenshot successful
https://edge-star-shv-01-cdg2.facebook.com/: screenshot timed out
https://edge-extern-shv-01-waw1.facebook.com/: screenshot timed out
https://edge-secure-shv-01-ham3.facebook.com/: screenshot timed out
https://sv-se.facebook.com/: screenshot timed out
https://ko.facebook.com/: screenshot timed out
https://synthetic-e2e-elbprod-sli-shv-01-otp1.facebook.com/: screenshot successful
Calculating page structures... done
Clustering similar pages... done
Generating HTML report... done

Writing session file...Time:
 - Started at  : 2021-10-06T10:14:42+01:00
 - Finished at : 2021-10-06T10:15:01+01:00
 - Duration    : 19s

Requests:
 - Successful : 12
 - Failed     : 5

 - 2xx : 10
 - 3xx : 0
 - 4xx : 2
 - 5xx : 0

Screenshots:
 - Successful : 2
 - Failed     : 10

Wrote HTML report to: aquatone/aquatone_report.html
```


```bash
whatweb -a4 app.inlanefreight.local -v
```

### Practice
***Q1***`What Apache version is running on app.inlanefreight.local? (Format: 0.0.0)`
```text
2.4.41
```
> [!INFO] How
> `fas:InfoCircle` To find this out i used *whatweb*
> **Command:-** `whatweb -a4 app.inlanefreight.local` 

***Q2***   `Which CMS is used on app.inlanefreight.local? (Format: word)`
***Q3***    `On which operating system is the dev.inlanefreight.local webserver running on? (Format: word)`
```text
A2 - joomla
A3 - Ubuntu
```

> [!INFO] How
> `fas:InfoCircle` I visited both web pages from a web-browser with the [***Wappalyzer***](https://www.wappalyzer.com/) extension. which can also export csv tables:

| Field                 | Value                           |
| --------------------- | ------------------------------- |
| URL                   | https://dev.inlanefreight.local |
| CMS                   | Joomla                          |
| Font scripts          | Google Font API                 |
| Miscellaneous         | RSS                             |
| Web servers           | Apache HTTP Server              |
| Programming languages | PHP                             |
| Operating systems     | Ubuntu                          |
| JavaScript libraries  | jQuery ; jQuery Migrate         |
| UI frameworks         | Bootstrap                       |

-----------------------
# Active Subdomain Enumeration

## ZoneTransfers
The zone transfer is how a secondary DNS server receives information from the primary DNS server and updates it. The master-slave approach is used to organise DNS servers within a domain, with the slaves receiving updated DNS information from the master DNS. The master DNS server should be configured to enable zone transfers from secondary (slave) DNS servers, although this might be misconfigured.

In this example we will the [hackertarget](https://hackertarget.com/zone-transfer/) and we will be using the zonetransfer.me

![[Pasted image 20240506215354.png]]

We can also take the manual approach via the command line: 

### 1. Identifying Nameservers
![[Pasted image 20240506221023.png]]
>Perform the Zone transfer using `-type=any` and `-query=AXFR` parameters

### 2. Testing for ANY AXFR Zone Transfer

```bash
netrunner404@htb[/htb]$ nslookup -type=any -query=AXFR zonetransfer.me nsztm1.digi.ninja

Server:		nsztm1.digi.ninja
Address:	81.4.108.41#53

zonetransfer.me
	origin = nsztm1.digi.ninja
	mail addr = robin.digi.ninja
	serial = 2019100801
	refresh = 172800
	retry = 900
	expire = 1209600
	minimum = 3600
zonetransfer.me	hinfo = "Casio fx-700G" "Windows XP"
zonetransfer.me	text = "google-site-verification=tyP28J7JAUHA9fw2sHXMgcCC0I6XBmmoVi04VlMewxA"
zonetransfer.me	mail exchanger = 0 ASPMX.L.GOOGLE.COM.
zonetransfer.me	mail exchanger = 10 ALT1.ASPMX.L.GOOGLE.COM.
zonetransfer.me	mail exchanger = 10 ALT2.ASPMX.L.GOOGLE.COM.
zonetransfer.me	mail exchanger = 20 ASPMX2.GOOGLEMAIL.COM.
zonetransfer.me	mail exchanger = 20 ASPMX3.GOOGLEMAIL.COM.
zonetransfer.me	mail exchanger = 20 ASPMX4.GOOGLEMAIL.COM.
zonetransfer.me	mail exchanger = 20 ASPMX5.GOOGLEMAIL.COM.
Name:	zonetransfer.me
Address: 5.196.105.14
zonetransfer.me	nameserver = nsztm1.digi.ninja.
zonetransfer.me	nameserver = nsztm2.digi.ninja.
_acme-challenge.zonetransfer.me	text = "6Oa05hbUJ9xSsvYy7pApQvwCUSSGgxvrbdizjePEsZI"
_sip._tcp.zonetransfer.me	service = 0 0 5060 www.zonetransfer.me.
14.105.196.5.IN-ADDR.ARPA.zonetransfer.me	name = www.zonetransfer.me.
asfdbauthdns.zonetransfer.me	afsdb = 1 asfdbbox.zonetransfer.me.
Name:	asfdbbox.zonetransfer.me
Address: 127.0.0.1
asfdbvolume.zonetransfer.me	afsdb = 1 asfdbbox.zonetransfer.me.
Name:	canberra-office.zonetransfer.me
Address: 202.14.81.230
cmdexec.zonetransfer.me	text = "; ls"
contact.zonetransfer.me	text = "Remember to call or email Pippa on +44 123 4567890 or pippa@zonetransfer.me when making DNS changes"
Name:	dc-office.zonetransfer.me
Address: 143.228.181.132
Name:	deadbeef.zonetransfer.me
Address: dead:beaf::
dr.zonetransfer.me	loc = 53 20 56.558 N 1 38 33.526 W 0.00m 1m 10000m 10m
DZC.zonetransfer.me	text = "AbCdEfG"
email.zonetransfer.me	naptr = 1 1 "P" "E2U+email" "" email.zonetransfer.me.zonetransfer.me.
Name:	email.zonetransfer.me
Address: 74.125.206.26
Hello.zonetransfer.me	text = "Hi to Josh and all his class"
Name:	home.zonetransfer.me
Address: 127.0.0.1
Info.zonetransfer.me	text = "ZoneTransfer.me service provided by Robin Wood - robin@digi.ninja. See http://digi.ninja/projects/zonetransferme.php for more information."
internal.zonetransfer.me	nameserver = intns1.zonetransfer.me.
internal.zonetransfer.me	nameserver = intns2.zonetransfer.me.
Name:	intns1.zonetransfer.me
Address: 81.4.108.41
Name:	intns2.zonetransfer.me
Address: 167.88.42.94
Name:	office.zonetransfer.me
Address: 4.23.39.254
Name:	ipv6actnow.org.zonetransfer.me
Address: 2001:67c:2e8:11::c100:1332
Name:	owa.zonetransfer.me
Address: 207.46.197.32
robinwood.zonetransfer.me	text = "Robin Wood"
rp.zonetransfer.me	rp = robin.zonetransfer.me. robinwood.zonetransfer.me.
sip.zonetransfer.me	naptr = 2 3 "P" "E2U+sip" "!^.*$!sip:customer-service@zonetransfer.me!" .
sqli.zonetransfer.me	text = "' or 1=1 --"
sshock.zonetransfer.me	text = "() { :]}; echo ShellShocked"
staging.zonetransfer.me	canonical name = www.sydneyoperahouse.com.
Name:	alltcpportsopen.firewall.test.zonetransfer.me
Address: 127.0.0.1
testing.zonetransfer.me	canonical name = www.zonetransfer.me.
Name:	vpn.zonetransfer.me
Address: 174.36.59.154
Name:	www.zonetransfer.me
Address: 5.196.105.14
xss.zonetransfer.me	text = "'><script>alert('Boo')</script>"
zonetransfer.me
	origin = nsztm1.digi.ninja
	mail addr = robin.digi.ninja
	serial = 2019100801
	refresh = 172800
	retry = 900
	expire = 1209600
	minimum = 3600
```

# GoBuster

Gobuster is a tool that we can use to perform subdomain enumeration. It is especially interesting for us the patterns options as we have learned some naming conventions from the passive information gathering we can use to discover new subdomains following the same pattern.

while doing the passive enum, we found a reverse DNS url; it typically will look like this:-
==edge-star-mini-shv-02-lhr6.facebook.com==
==lert-api-shv-{NUMBER}-sin6.facebook.com==
==atlas-pp-shv-{GOBUSTER}-sin6==

make a file called patterns.txt and we will add them like so:
```bash
edge-star-mini-shv-{GOBUSTER}-lhr6
edge-star-mini-shv-{GOBUSTER}-man2
```

the next thing i do is create a numbers .txt file with the number 01 to 99 

next we set the variables like so: 
```bash
export TARGET="facebook.com"
export NS="d.ns.facebook.com"
export WORDLIST="numbers.txt"
```

Now we run gobuster with the following command: 
```bash
gobuster dns -q -r "${NS}" -d "${TARGET}" -w "${WORDLIST}" -p ./patterns.txt -o "gobuster_${TARGET}.txt"
```

*Command Breakdown*
- `dns`: Launch the DNS module
- `-q`: Don't print the banner and other noise.
- `-r`: Use custom DNS server
- `-d`: A target domain name
- `-p`: Path to the patterns file
- `-w`: Path to the wordlist
- `-o`: Output file

what we found: 
![[Pasted image 20240507015949.png]]

```bash
Found: edge-star-mini-shv-02-lhr6.facebook.com

Found: edge-star-mini-shv-01-lhr6.facebook.com

Found: edge-star-mini-shv-01-man2.facebook.com
```

### Questions

#### Q1 HTB
> [!Question]
> **Q1** `Submit the FQDN of the nameserver for the "inlanefreight.htb" domain as the answer.`

> [!Awnser]
> ```bash
> ns.inlanefreight.htb
> ```

> [!HOW]
> This was found by using the following command
> ```bash
> nslookup -type=NS inlanefreight.htb 10.129.206.153
> ```

#### Q2 HTB

> [!Question]
> `Identify how many zones exist on the target nameserver. Submit the number of found zones as the answer.` 

> [!NOTE]
>  **Awnser:**
>  ```bash
> inlanefreight.htb.	604800	IN	SOA	inlanefreight.htb. root.inlanefreight.htb. 2 604800 86400 2419200 604800
>  
>  The Awnser is 2 
> ```

> [!INFO]
> **Command Used**
> ```bash
> dig @10.129.206.153 inlanefreight.htb AXFR
> ```
> 

#### Q3 HTB

> [!Question]
> `Find and submit the contents of the TXT record as the answer.`

> [!NOTE]
> Awnser:
> ```bash
> ZONE_TRANSFER{87o2z3cno7zsoiedznxoi82z3o47xzhoi}
> ```
> 
> How: 
> ```bash
> dig @10.129.206.153 internal.inlanefreight.htb AXFR
> ```

